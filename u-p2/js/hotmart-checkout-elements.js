(function(u){typeof define=="function"&&define.amd?define(u):u()})(function(){"use strict";var A=Object.defineProperty;var M=(u,f,p)=>f in u?A(u,f,{enumerable:!0,configurable:!0,writable:!0,value:p}):u[f]=p;var y=(u,f,p)=>(M(u,typeof f!="symbol"?f+"":f,p),p);const u=["overlayCheckout","salesFunnel","inlineCheckout","jsInterface","element:creditCardForm"],f=(c,n)=>{const{id:t,minHeight:r,minWidth:o}=n,e=document.createElement("iframe");return t&&(e.id=t),e.className="custom-element__iframe",e.style.width="100%",e.style.minWidth=o??"320px",e.style.minHeight=r??"300px",e.style.border="0 none",e.style.display="block",e.allow="clipboard-write; payment *",e.src=c,e},p="https://pay.hotmart.com";class _{constructor(n,t){y(this,"options",{payment:{},visibilityOptions:{}});y(this,"wrapperElement");y(this,"iframeElement");y(this,"iframeURL",new URL(p));y(this,"iframeOptions",{});this.options=n,console.debug("@@@@ this.options:",this.options);const o={...{elements_document_height_update:e=>{this.iframeElement&&(this.iframeElement.style.height=e)},on_load:e=>{var i,h,m,l,a,s,d,w,b,I,O,g,T;this.postMessage({action:"set_data",data:{shopperData:(i=this.options.payment)==null?void 0:i.shopperData,hasErrorCallback:!!((h=this.options.payment)!=null&&h.onError),countryIsoCode:((m=this.options)==null?void 0:m.countryIsoCode)??"",gateways:(s=(a=(l=this.options)==null?void 0:l.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:s.gateways,context:(b=(w=(d=this.options)==null?void 0:d.elementOptions)==null?void 0:w.creditCardForm)==null?void 0:b.context,isSettlePayment:((I=this.options)==null?void 0:I.isSettlePayment)??!1,isPurchaseDataIncomplete:((O=this.options)==null?void 0:O.isPurchaseDataIncomplete)??!1}}),(T=(g=this.options)==null?void 0:g.onLoad)==null||T.call(g,e)},on_load_data_error:e=>{var i,h;(h=(i=this.options)==null?void 0:i.onLoadDataError)==null||h.call(i,e)},on_is_full_loading:e=>{var i,h;(h=(i=this.options)==null?void 0:i.onIsFullLoading)==null||h.call(i,e.visible)}},...t||{}};window.addEventListener("message",e=>{var h;const i=e.source!==((h=this.iframeElement)==null?void 0:h.contentWindow);e.origin!==this.iframeURL.origin||i||(console.debug("@@@@ message:",e),!(!e.data.action||!Object.keys(o).includes(e.data.action))&&o[e.data.action](e.data.data))})}updateOptions(n){this.options={...this.options,...n}}postMessage({action:n,data:t}){var r,o;(o=(r=this.iframeElement)==null?void 0:r.contentWindow)==null||o.postMessage({action:n,data:t},"*")}_buildIframeUrl(){if(this.options.integrationKey&&this.iframeURL.searchParams.append("integrationKey",this.options.integrationKey),this.options.locale&&this.iframeURL.searchParams.append("locale",this.options.locale),this.options.countryIsoCode&&this.iframeURL.searchParams.append("countrycode",this.options.countryIsoCode),this.options.prefilledInfo)for(const[n,t]of Object.entries(this.options.prefilledInfo))this.iframeURL.searchParams.append(n,t);if(this.options.visibilityOptions)for(const[n,t]of Object.entries(this.options.visibilityOptions))this.iframeURL.searchParams.append(n,t)}mount(n){var r;this._buildIframeUrl();const t=f(this.iframeURL.href,this.iframeOptions);this.iframeElement=t,this.wrapperElement=typeof n=="string"?document.querySelector(n):n,this.wrapperElement&&(this.wrapperElement.innerHTML="",(r=this.wrapperElement)==null||r.appendChild(t),console.debug("@@@@ element mounted successfully"))}}class x extends _{constructor(t){const r={on_load_data:o=>{var e,i;(i=(e=this.options)==null?void 0:e.onLoadData)==null||i.call(e,o)},on_payment_approve:o=>{var e;(e=this.paymentPromise)==null||e.resolve(o),this.paymentPromise=void 0},on_payment_analysis:o=>{var e;(e=this.paymentPromise)==null||e.resolve(o),this.paymentPromise=void 0},on_payment_error:o=>{var e;console.log("@@@@ on_payment_error",o),(e=this.paymentPromise)==null||e.reject(o),this.paymentPromise=void 0}};t.payment={...t.payment,onError:()=>{}};super(t,r);y(this,"paymentPromise");this.iframeURL=this.buildIframeUrl(t.offer),console.debug("@@@@ Initializing CheckoutJSInterface"),this.mount()}buildIframeUrl(t){if(!t||t.trim()==="")throw new Error("Offer cannot be empty");return new URL(`${p}/elements/js-interface?off=${t}&checkoutMode=2`)}createInvisibleIframe(){const t=f(this.iframeURL.href,this.iframeOptions);return t.id="checkout-js-interface-iframe",t.style.display="none",t.style.position="absolute",t.style.width="0",t.style.height="0",t.style.border="0",t.style.top="-9999px",t.style.left="-9999px",console.debug("@@@@ CheckoutJsInterface element mounted invisibly"),t}mount(){if(this.iframeElement){console.warn("CheckoutJSInterface element already mounted.");return}const t=document.getElementById("checkout-js-interface-iframe");t&&t.remove(),this._buildIframeUrl(),this.iframeElement=this.createInvisibleIframe(),document.body.appendChild(this.iframeElement)}async processPayment(t){if(this.paymentPromise)throw new Error("A payment is already in progress");return this.postMessage({action:"process_payment",data:t}),new Promise((r,o)=>{this.paymentPromise={resolve:r,reject:o}})}}const P="https://pci-pay.hotmart.com";class E extends _{constructor(n,t){const r={on_payment_analysis:o=>{var e,i;(i=(e=this.options.payment)==null?void 0:e.onAnalysis)==null||i.call(e,o)},on_payment_approve:o=>{var e,i;(i=(e=this.options.payment)==null?void 0:e.onSuccess)==null||i.call(e,o)},on_payment_error:o=>{var e,i;(i=(e=this.options.payment)==null?void 0:e.onError)==null||i.call(e,o)},on_payment_receive:o=>{var e,i;(i=(e=this.options.payment)==null?void 0:e.onReceive)==null||i.call(e,o)},on_submit_payment:({actionToCall:o})=>{var e,i;this.postMessage({action:"process_payment",data:{shopperData:(e=this.options.payment)==null?void 0:e.shopperData,hasErrorCallback:!!((i=this.options.payment)!=null&&i.onError),actionToCall:o}})},...t||{}};super(n,r),this.iframeURL=new URL(`${p}/elements?off=${this.options.offer}&checkoutMode=2`),this.options.bid=new Date().getTime()}}class L extends E{constructor(n){super(n),console.debug("@@@@ Initializing OverlayCheckout element"),Promise.resolve().then(()=>j).then(t=>{const r=document.createElement("style");r.innerText=t.default,document.head.append(r)})}onKeyUp(n){n.key==="Escape"&&this.destroy()}attach(n){const t=typeof n=="string"?document.querySelector(n):n;n&&(t==null||t.addEventListener("click",r=>{r.preventDefault();const o=document.createElement("div");o.id="custom-element-lightbox-overlay",o.className="custom-element__lightbox-overlay",o.addEventListener("click",()=>{this.destroy()});const e=document.createElement("div");e.id="custom-element-lightbox-modal",e.className="custom-element__lightbox-modal",super.mount(e),document.body.appendChild(o),document.body.appendChild(e)}),document.addEventListener("keyup",r=>this.onKeyUp(r)),console.debug("@@@@ OverlayCheckout attached successfully"))}mount(n){this.attach(n)}destroy(){var n,t;(n=document.getElementById("custom-element-lightbox-overlay"))==null||n.remove(),(t=document.getElementById("custom-element-lightbox-modal"))==null||t.remove()}}class U extends E{constructor(n){super(n),this.iframeURL=new URL(`${p}/funnel${this.getMainPageSearchParams()}`),console.debug("@@@@ Initializing SalesFunnel element")}getMainPageSearchParams(){var n;try{const t=(n=window.top)==null?void 0:n.location,r=window.location,o=(t==null?void 0:t.search)||r.search||"";if(o)return o;const e=t||r;return(e==null?void 0:e.search)||`?${e.toString().split("?")[1]}`}catch{return window.location.search||""}}}class F extends E{constructor(n){super(n);const t=new URL(`${p}/elements`);this.options.offer&&t.searchParams.append("off",this.options.offer),this.options.intent&&(t.pathname+="/payment-methods-elements",t.searchParams.append("intent",this.options.intent)),t.searchParams.append("checkoutMode","2"),this.iframeURL=t,console.debug("@@@@ Initializing InlineCheckout element")}}class z extends _{constructor(t){var i,h;const r={on_generate_tokens_intent_success:m=>{var l,a,s,d;this._resolveTokenization(m),(d=(s=(a=(l=this.options)==null?void 0:l.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:s.onGenerateTokensSuccess)==null||d.call(s,m)},on_generate_tokens_intent_error:m=>{var l,a,s,d;this._rejectTokenization(m),(d=(s=(a=(l=this.options)==null?void 0:l.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:s.onGenerateTokensError)==null||d.call(s,m)},on_credit_card_form_valid:()=>{var m,l,a,s;(s=(a=(l=(m=this.options)==null?void 0:m.elementOptions)==null?void 0:l.creditCardForm)==null?void 0:a.onValidationSuccess)==null||s.call(a)},on_credit_card_form_invalid:m=>{var l,a,s,d;(d=(s=(a=(l=this.options)==null?void 0:l.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:s.onValidationError)==null||d.call(s,m)},on_credit_card_form_blur:m=>{var l,a,s,d;(d=(s=(a=(l=this.options)==null?void 0:l.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:s.onBlur)==null||d.call(s,m)},on_credit_card_info:m=>{var l,a,s,d;(d=(s=(a=(l=this.options)==null?void 0:l.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:s.onCardInfoUpdate)==null||d.call(s,m)}},o=(h=(i=t.elementOptions)==null?void 0:i.creditCardForm)==null?void 0:h.gateways,e=o&&Array.isArray(o)&&o.length?o:["ADYEN","WORLDPAY","DLOCAL","PAYU","EBANX","YUNO"];t.elementOptions={...t.elementOptions,creditCardForm:{...t.elementOptions.creditCardForm,gateways:e}};super(t,r);y(this,"TOKENIZATION_TIMEOUT",12e3);y(this,"pendingTokenization",null);this.iframeURL=new URL(`${P}/elements/credit-card-form`),this.iframeOptions={minHeight:"235px",minWidth:"210px"},console.debug("@@@@ Initializing creditCardForm element")}async generateTokens(){return this.pendingTokenization?Promise.reject(new Error("Tokenization already in progress")):new Promise((t,r)=>{const o=setTimeout(()=>this._rejectTokenization(new Error("Tokenization timeout")),this.TOKENIZATION_TIMEOUT);this.pendingTokenization={resolve:e=>{clearTimeout(o),this.pendingTokenization=null,t(e)},reject:e=>{clearTimeout(o),this.pendingTokenization=null,r(e)}};try{this.postMessage({action:"generate_tokens_intent",data:{}}),console.debug("@@@@ tryToGenerateTokens Button triggered")}catch(e){this._rejectTokenization(e)}})}_resolveTokenization(t){this.pendingTokenization&&this.pendingTokenization.resolve(t)}_rejectTokenization(t){this.pendingTokenization&&this.pendingTokenization.reject(t)}validateForm(){this.postMessage({action:"validate_intent",data:{}}),console.debug("@@@@ tryToValidateForm Button triggered")}}const C=(c,n={})=>{var i;if(n.off&&(n.offer=n.off),!(n.offer||n.intent||n.affiliation)&&["overlayCheckout","inlineCheckout"].includes(c))throw new Error("Offer, intent or affiliation must be present");if(c==="element:creditCardForm"&&!((i=n.elementOptions)!=null&&i.creditCardForm.context))throw new Error("Context must be present on credit card form elements options");const e={overlayCheckout:()=>new L(n),inlineCheckout:()=>new F(n),salesFunnel:()=>new U(n),jsInterface:()=>new x(n),"element:creditCardForm":()=>new z(n)};if(console.debug("@@@@ Initializing Checkout Elements"),!u.includes(c))throw new Error(`Element type ${c} not available, please check the documentation`);return e[c]()},R=10;let k=0;function v(){window.setTimeout(()=>{if(k>=R)return;k+=1;const c=Array.from(document.querySelectorAll("#hotmart-sales-funnel"));if(!c.length){v();return}c.some(n=>n.hasChildNodes())||C("salesFunnel").mount(c[0])},250)}v(),window.checkoutElements={init:C};const j=Object.freeze(Object.defineProperty({__proto__:null,default:".custom-element__iframe{border:none}.custom-element__lightbox-overlay{background-color:#000;position:fixed;width:100%;height:100%;top:0;left:0;opacity:.8}.custom-element__lightbox-modal{position:fixed;width:90%;max-width:90vw;min-height:500px;max-height:90vh;top:5%;left:50%;transform:translate(-50%);overflow:scroll}"},Symbol.toStringTag,{value:"Module"}))});
